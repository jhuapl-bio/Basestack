mytax_kraken2_report:
  title: "Kraken2 Mytax"
  icon: "binoculars"
  init: false
  tooltip: "Run Kraken 2 classification and receive report file then json for visualization"
  force_restart: true
  config: null  
  tags: 
    - "kraken2"
    - "metagenomic"
    - metagenome
  linking:
    - output:  #From where to where as input to next procedure
        service: mytax_kraken2_report
        target: outputs
        variable: report
      input: 
        service: mytax_create_json
        target: variables
        variable: file
  services: 
    - mytax_kraken2_report
    - mytax_create_json
mytax_visualization:
  title: "Kraken2 Mytax Visualization"
  icon: "chart-pie"
  init: false
  continuous: true
  tags: 
    - "kraken2"
    - "metagenomic"
    - "sunburst"
  tooltip: "View Sunburt from JSON report of Kraken/Centrifuge run"
  force_restart: false
  config: null  
  services: 
    - mytax_visualization

    
# - name: "mytax_visualization"  
#   title: "Mytax Visualization"
#   icon: "dna"
#   tooltip: "View Mytax Visulization"
#   services:
#     - command: ["python3", "-m", "http.server", "8081"]
#         name: mytax_visualization
#         image: "jhuaplbio/basestack_mytax"
#         init: true
#         hideStatus: true
#         label: "Visualization"
#         force_restart: true 
#         config: null
#         workingdir: "/opt/software/mytax/sunburst"
#         ports: 
#           - 8081
#         variables:
#           - name: port
#             element: "render"
#             source: "8081"
#         orchestrated: false #orchestrated means it runs from dind rather than natively
# - command: ["bash","-c", "echo $name second && sleep 7" ]
#   name: mytax_test_variables_second
#   label: "TestSecond" 
#   image: "jhuaplbio/basestack_mytax"
#   workingdir: "/opt/test-data"
#   orchestrated: false #orchestrated means it r
#   variables:
#     - name: name
#       label: "Name"
#       element: "string"
#       source: "hello testing"
#       class: "wb-25"
# - name: "mytax_report"  
# title: "Mytax Report Generation"
# icon: "dna"
# tooltip: "Run Kraken Classification and View"
# force_restart: true
# force_init: false
# config: null  
# init: false
# services: 
#   - command: ["bash","-c", "source /opt/conda/etc/profile.d/conda.sh && conda activate mytax && 
#       kraken --db ${db} --output ${file}.out ${file} && 
#       kraken-report --db ${db}  ${file}.out | tee  ${file}.report && 
#       bash krakenreport_fullstring.sh -i ${file}.report -k ${db} -o ${file}.fullstring &&
#       bash krakenreport2json.sh -i ${file}.fullstring -o ${file}.json" 
#     ]
#     label: "Report"
#     image: "jhuaplbio/basestack_mytax"
#     workingdir: "/opt/test-data"
#     orchestrated: false #orchestrated means it r
#     progress: 
#       - label: "Out"
#         element: "file" 
#         source: "${0.source}.out"   #Source must be a variable reference if referencing an env variable run          
#       - label: "Report"
#         element: "file" 
#         source: "${0.source}.report" 
#       - label: "Fullstring"
#         element: "file" 
#         source: "${0.source}.fullstring" 
#       - label: "JSON"
#         element: "file" 
#         source: "${0.source}.json" 
#         final_output: true
#     variables:
#       - name: file
#         label: "Input FASTA/Q File"
#         element: "file"
#         bind_parent_dir: true
#         bind: "/opt/data"
#         class: "wb-50  p-3 mb-1"
#         source: ""
#       - name: db
#         label: "Input classifier database"
#         class: "wb-50 p-3 mb-1"
#         options:
#           - element: null
#             name: "Minikraken2017"
#             variables:
#               value: "minikraken"
#             source: "/opt/databases/${value}" #This ${} is converted into the variable attribute of selected option only!
#           - element: null
#             name: "Flukraken2021"
#             source: "/opt/databases/${value}" 
#             variables:
#               value: "flukraken"
#             cmd: "tar -xvzf ${db}.tar.gz -C /opt/databases/flukraken"
#             placement: "2" #Where to place the command in the above command (before) as appending starting at 0 index. 
#           - element: "dir"
#             name: "Custom DB"
#             source: "" 
#             bind: "/opt/databases" 
#   - command: ["bash", "-c", "source /opt/conda/etc/profile.d/conda.sh &&
#             conda activate mytax && ls ${db} && pwd && bash process_krakendb.sh -k ${db}"
#     ]
#     name: mytax_process_db
#     label: "Process Kraken DB"
#     image: "jhuaplbio/basestack_mytax"
#     init: false
#     force_restart: true
#     force_init: false
#     config: null
#     workingdir: "/opt"
#     orchestrated: false #Process Database for kraken use in mytax
#     variables:
#       - name: db
#         label: "Input kraken-unprocessed DB"
#         element: "dir"
#         source: "" 
#         bind: "/opt/databases"