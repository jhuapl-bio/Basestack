# make a yaml file example file using the kraken2.yml file as a reference, but just do a basic Native echo hello world
# must have name and dependencies and command of echo hello world
# This is it in the minimap2 file
- title: TaxTriage
  date_added: '2023-11-07T11:40:13.131Z'
  url: "None"
  description: Unknown Patogen Identification Report Generator
  icon: mdi-virus
  name: taxtriage
  defaultchoice: 0
  tags:
    - pathogen
    - detection
    - metagenomics
    - report
  variables:
    samplesheet:
      element: "spreadsheet"
      label: "Input Samplesheet"
      info: "Samplesheet example"
      pattern: '.*.csv'
      data:
        - key: sample
          label: "Sample"
          info: "Sample name"
          type: "string"
        - key: fastq_1
          label: "Fastq1"
          info: "Fastq1 file"
          type: "file"
          pattern: '.*.fastq'
        - key: fastq_2
          label: "Fastq2"
          info: "Fastq2 file"
          type: "file"
          optional: True
          pattern: '.*.fastq'
        - key: barcode
          label: "Barcode"
          info: "Barcode"
          type: "boolean"
          optional: True
        - key: platform
          label: "Platform"
          choices: ['ILLUMINA', 'OXFORD']
          info: "Platform"
          type: "string" 
          optional: True
        - key: single_end
          label: "Single End"
          info: "Single End"
          type: "boolean"
          optional: True
        - key: trim
          label: "Trim"
          info: "Trim"
          type: "boolean"
          optional: True
        - key: sequencing_summary
          label: "Sequencing Summary"
          info: "Sequencing Summary"
          type: "file"
          optional: True
          pattern: '.*sequencing.*summary.*.txt'
        - key: from
          label: "From"
          info: "From"
          type: "directory"
          optional: True
    profile:
      element: "list"
      label: "Singularity or Docker"
      info: "Which containerized approach do you want?"
      target: "docker"
      choices: [
        "singularity",
        "docker"
      ]
    revision:
      element: "string"
      info: "Default is main (bleeding edge). Or choose stable for most up to date stable version"
      label: "Branch/version"
      target: "main"
    db:
      element: "list-directory"
      output: False
      label: "Kraken2 database"
      info: "Kraken2 database, must contain k2d file(s)"
      choices: [
        "${dependenciesWritePath}/files/flukraken2",
        "${dependenciesWritePath}/files/minikraken_8GB_202003"
      ]
      target: null
    cpu_count:
      element: "number"
      label: "Maximum CPU"
      info: Max cpu to use"
      target: 3
      min: 1
      required: true
      step:  1
    max_memory:
      element: "number"
      label: "Maximum RAM"
      info: Max RAM, heavily dependent on the database in question"
      target: 10
      step: 0.2
      min: 1
      default: 10
    low_memory :
      element: "checkbox"
      label: "Low Memory Mode"
      info: Dont load the database into memory
      target: null
      if: "--low_memory "
      else: ""
    resume :
      element: "checkbox"
      label: "Resume"
      info: Dont load the database into memory
      target: True
      default: true
      if: "-resume "
      else: ""
    latest :
      element: "checkbox"
      label: "Latest "
      info: Pull the latest version
      target: true 
      default: true
      if: " -latest "
      else: ""
    outputreport:
      element: "static-file"
      pattern: ".*.html"
      output: True
      label: "Report output"
      info: "Interactive HTML Report"
      target: "%directory($samplesheet)%/tmp/multiqc/multiqc_report.html"
  choices: 
    - key: "Native"
      label: "Native"
      exec: "native"
      requirements:
        - key: "nextflow"
          type: "executions"
        - key: "flukraken2"
          type: "files"
      env: "base"
      command: " cd   ; nextflow run https://github.com/jhuapl-bio/taxtriage -r %$revision%
        --input  \"%$samplesheet%\" 
        --db \"%$db%\"  --skip_assembly  %$low_memory%
        --outdir %directory($samplesheet)%/tmp --max_memory %$max_memory%GB --max_cpus %$cpu_count%  --skip_plots 
        -profile %$profile%  %$resume%  %$latest%  --demux --remove_taxids \"9606 9606\"  "    
    